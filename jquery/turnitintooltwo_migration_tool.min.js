function displayMigrationModal(){$("#migrate_type").data("turnitintoolid")!=$("#migrate_type").data("lastasked")&&($.colorbox({width:550,height:600,inline:!0,opacity:"0.7",href:"#migration_alert",onLoad:function(){$("#asktomigrate").show(),lightBoxCloseButton()},onCleanup:function(){$("#tii_close_bar").remove(),$("#migration_alert").hide()}}),$("#migration_alert").show()),2==$("#migrate_type").data("migratetype")&&($("#asktomigrate").hide(),$("#migrating").show(),migrate($("#migrate_type").data("courseid"),$("#migrate_type").data("turnitintoolid")))}function migrate(t,o){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"begin_migration",courseid:t,turnitintoolid:o,sesskey:M.cfg.sesskey},success:function(t){$.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+t.id},error:function(t){var o=t.responseJSON;$.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),$("#turnitintool_style").prepend('<div id="full-error" class="box generalbox noticebox">'+o.error+" "+o.message+"</div>"),o.hasOwnProperty("trace")&&(console.error(o.message),console.error(JSON.stringify(o.trace,null,4)))}})}function lightBoxCloseButton(){$("body").append('<div id="tii_close_bar"><a href="#" onclick="$.colorbox.close(); return false;">'+M.str.turnitintooltwo.closebutton+"</a></div>")}$(document).ready(function(){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"check_migrated",turnitintoolid:$("#migrate_type").data("turnitintoolid"),sesskey:M.cfg.sesskey},success:function(t){1==t.migrated?window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+t.v2id:displayMigrationModal()}})}),$(".migrate_link").click(function(){$("#asktomigrate").hide(),$("#migrating").show(),migrate($(this).data("courseid"),$(this).data("turnitintoolid"))}),$(".dontmigrate_link").click(function(){$.colorbox.close(),$("#migration_alert").hide()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR1cm5pdGludG9vbHR3b19taWdyYXRpb25fdG9vbC5qcyJdLCJuYW1lcyI6WyJkaXNwbGF5TWlncmF0aW9uTW9kYWwiLCIkIiwiZGF0YSIsImNvbG9yYm94Iiwid2lkdGgiLCJoZWlnaHQiLCJpbmxpbmUiLCJvcGFjaXR5IiwiaHJlZiIsIm9uTG9hZCIsInNob3ciLCJsaWdodEJveENsb3NlQnV0dG9uIiwib25DbGVhbnVwIiwicmVtb3ZlIiwiaGlkZSIsIm1pZ3JhdGUiLCJjb3Vyc2VpZCIsInR1cm5pdGludG9vbGlkIiwiYWpheCIsImRhdGFUeXBlIiwidHlwZSIsInVybCIsIk0iLCJjZmciLCJ3d3dyb290IiwiYWN0aW9uIiwic2Vzc2tleSIsInN1Y2Nlc3MiLCJjbG9zZSIsIndpbmRvdyIsImxvY2F0aW9uIiwiaWQiLCJlcnJvciIsInJlc3BvbnNlSlNPTiIsInByZXBlbmQiLCJtZXNzYWdlIiwiaGFzT3duUHJvcGVydHkiLCJjb25zb2xlIiwiSlNPTiIsInN0cmluZ2lmeSIsInRyYWNlIiwiYXBwZW5kIiwic3RyIiwidHVybml0aW50b29sdHdvIiwiY2xvc2VidXR0b24iLCJkb2N1bWVudCIsInJlYWR5IiwibWlncmF0ZWQiLCJ2MmlkIiwiY2xpY2siLCJ0aGlzIl0sIm1hcHBpbmdzIjoiQUFpQ0EsUUFBU0EseUJBRURDLEVBQUUsaUJBQWlCQyxLQUFLLG1CQUFxQkQsRUFBRSxpQkFBaUJDLEtBQUssZUFDckVELEVBQUVFLFVBQVVDLE1BQU8sSUFBS0MsT0FBUSxJQUFLQyxRQUFPLEVBQU1DLFFBQVMsTUFBT0MsS0FBSyxtQkFDbkVDLE9BQVEsV0FDSlIsRUFBRSxpQkFBaUJTLE9BQ25CQyx1QkFFSkMsVUFBVSxXQUNOWCxFQUFFLGtCQUFrQlksU0FDcEJaLEVBQUUsb0JBQW9CYSxVQUc5QmIsRUFBRSxvQkFBb0JTLFFBR29CLEdBQTFDVCxFQUFFLGlCQUFpQkMsS0FBSyxpQkFDeEJELEVBQUUsaUJBQWlCYSxPQUNuQmIsRUFBRSxjQUFjUyxPQUVoQkssUUFBUWQsRUFBRSxpQkFBaUJDLEtBQUssWUFBYUQsRUFBRSxpQkFBaUJDLEtBQUssb0JBSTdFLFFBQVNhLFNBQVFDLEVBQVVDLEdBQ3ZCaEIsRUFBRWlCLE1BQ0VDLFNBQVksT0FDWkMsS0FBUSxPQUNSQyxJQUFLQyxFQUFFQyxJQUFJQyxRQUFVLGdDQUNyQnRCLE1BQVN1QixPQUFRLGtCQUFtQlQsU0FBVUEsRUFBVUMsZUFBZ0JBLEVBQWdCUyxRQUFTSixFQUFFQyxJQUFJRyxTQUN2R0MsUUFBUyxTQUFTekIsR0FDVkQsRUFBRUUsVUFDRkYsRUFBRUUsU0FBU3lCLFFBRWYzQixFQUFFLG9CQUFvQmEsT0FDdEJlLE9BQU9DLFNBQVN0QixLQUFPYyxFQUFFQyxJQUFJQyxRQUFVLG9DQUFvQ3RCLEVBQUs2QixJQUVwRkMsTUFBTyxTQUFTQSxHQUNaLEdBQUk5QixHQUFPOEIsRUFBTUMsWUFDYmhDLEdBQUVFLFVBQ0ZGLEVBQUVFLFNBQVN5QixRQUVmM0IsRUFBRSxvQkFBb0JhLE9BQ3RCYixFQUFFLHVCQUNHaUMsUUFBUSx5REFBMkRoQyxFQUFLOEIsTUFBUSxJQUFNOUIsRUFBS2lDLFFBQVUsVUFHdEdqQyxFQUFLa0MsZUFBZSxXQUNwQkMsUUFBUUwsTUFBTTlCLEVBQUtpQyxTQUNuQkUsUUFBUUwsTUFBTU0sS0FBS0MsVUFBVXJDLEVBQUtzQyxNQUFPLEtBQU0sUUFNL0QsUUFBUzdCLHVCQUNMVixFQUFFLFFBQVF3QyxPQUFPLG1GQUFxRm5CLEVBQUVvQixJQUFJQyxnQkFBZ0JDLFlBQWMsY0F6RjlJM0MsRUFBRTRDLFVBQVVDLE1BQU0sV0FHZDdDLEVBQUVpQixNQUNFQyxTQUFZLE9BQ1pDLEtBQVEsT0FDUkMsSUFBT0MsRUFBRUMsSUFBSUMsUUFBVSxnQ0FDdkJ0QixNQUNJdUIsT0FBUSxpQkFDUlIsZUFBZ0JoQixFQUFFLGlCQUFpQkMsS0FBSyxrQkFDeEN3QixRQUFTSixFQUFFQyxJQUFJRyxTQUVuQkMsUUFBVyxTQUFTekIsR0FDSyxHQUFqQkEsRUFBSzZDLFNBQ0xsQixPQUFPQyxTQUFTdEIsS0FBT2MsRUFBRUMsSUFBSUMsUUFBVSxvQ0FBb0N0QixFQUFLOEMsS0FFaEZoRCw2QkFNaEJDLEVBQUUsaUJBQWlCZ0QsTUFBTSxXQUNyQmhELEVBQUUsaUJBQWlCYSxPQUNuQmIsRUFBRSxjQUFjUyxPQUNoQkssUUFBUWQsRUFBRWlELE1BQU1oRCxLQUFLLFlBQWFELEVBQUVpRCxNQUFNaEQsS0FBSyxxQkFHbkRELEVBQUUscUJBQXFCZ0QsTUFBTSxXQUN6QmhELEVBQUVFLFNBQVN5QixRQUNYM0IsRUFBRSxvQkFBb0JhIiwiZmlsZSI6InR1cm5pdGludG9vbHR3b19taWdyYXRpb25fdG9vbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpe1xuXG4gICAgLy8gQ2hlY2sgd2hldGhlciB0aGlzIGFzc2lnbm1lbnQgaGFzIGJlZW4gbWlncmF0ZWQgaW4gdGhpcyBzZXNzaW9uIGFuZCByZWRpcmVjdCBpZiBzby5cbiAgICAkLmFqYXgoe1xuICAgICAgICBcImRhdGFUeXBlXCI6ICdqc29uJyxcbiAgICAgICAgXCJ0eXBlXCI6IFwiUE9TVFwiLFxuICAgICAgICBcInVybFwiOiBNLmNmZy53d3dyb290ICsgXCIvbW9kL3R1cm5pdGludG9vbHR3by9hamF4LnBocFwiLFxuICAgICAgICBcImRhdGFcIjoge1xuICAgICAgICAgICAgYWN0aW9uOiBcImNoZWNrX21pZ3JhdGVkXCIsIFxuICAgICAgICAgICAgdHVybml0aW50b29saWQ6ICQoXCIjbWlncmF0ZV90eXBlXCIpLmRhdGEoXCJ0dXJuaXRpbnRvb2xpZFwiKSxcbiAgICAgICAgICAgIHNlc3NrZXk6IE0uY2ZnLnNlc3NrZXlcbiAgICAgICAgfSxcbiAgICAgICAgXCJzdWNjZXNzXCI6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLm1pZ3JhdGVkID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IE0uY2ZnLnd3d3Jvb3QgKyBcIi9tb2QvdHVybml0aW50b29sdHdvL3ZpZXcucGhwP2lkPVwiK2RhdGEudjJpZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheU1pZ3JhdGlvbk1vZGFsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG4kKCcubWlncmF0ZV9saW5rJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCgnI2Fza3RvbWlncmF0ZScpLmhpZGUoKTtcbiAgICAkKCcjbWlncmF0aW5nJykuc2hvdygpO1xuICAgIG1pZ3JhdGUoJCh0aGlzKS5kYXRhKFwiY291cnNlaWRcIiksICQodGhpcykuZGF0YShcInR1cm5pdGludG9vbGlkXCIpKTtcbn0pO1xuXG4kKCcuZG9udG1pZ3JhdGVfbGluaycpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkLmNvbG9yYm94LmNsb3NlKCk7XG4gICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcbn0pO1xuXG5mdW5jdGlvbiBkaXNwbGF5TWlncmF0aW9uTW9kYWwoKSB7XG4gICAgLy8gT25seSBkaXNwbGF5IHRoZSBtb2RhbCBkdXJpbmcgYSBtYW51YWwgbWlncmF0aW9uLlxuICAgIGlmICgkKFwiI21pZ3JhdGVfdHlwZVwiKS5kYXRhKFwidHVybml0aW50b29saWRcIikgIT0gJChcIiNtaWdyYXRlX3R5cGVcIikuZGF0YShcImxhc3Rhc2tlZFwiKSkge1xuICAgICAgICAkLmNvbG9yYm94KHt3aWR0aDogNTUwLCBoZWlnaHQ6IDYwMCwgaW5saW5lOnRydWUsIG9wYWNpdHk6IFwiMC43XCIsIGhyZWY6XCIjbWlncmF0aW9uX2FsZXJ0XCIsXG4gICAgICAgICAgICBvbkxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoJyNhc2t0b21pZ3JhdGUnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgbGlnaHRCb3hDbG9zZUJ1dHRvbigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQ2xlYW51cDpmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKCcjdGlpX2Nsb3NlX2JhcicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJyNtaWdyYXRpb25fYWxlcnQnKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAkKCcjbWlncmF0aW9uX2FsZXJ0Jykuc2hvdygpO1xuICAgIH1cblxuICAgIGlmICgkKFwiI21pZ3JhdGVfdHlwZVwiKS5kYXRhKFwibWlncmF0ZXR5cGVcIikgPT0gMikge1xuICAgICAgICAkKCcjYXNrdG9taWdyYXRlJykuaGlkZSgpO1xuICAgICAgICAkKCcjbWlncmF0aW5nJykuc2hvdygpO1xuXG4gICAgICAgIG1pZ3JhdGUoJChcIiNtaWdyYXRlX3R5cGVcIikuZGF0YShcImNvdXJzZWlkXCIpLCAkKFwiI21pZ3JhdGVfdHlwZVwiKS5kYXRhKFwidHVybml0aW50b29saWRcIikpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWlncmF0ZShjb3Vyc2VpZCwgdHVybml0aW50b29saWQpIHtcbiAgICAkLmFqYXgoe1xuICAgICAgICBcImRhdGFUeXBlXCI6ICdqc29uJyxcbiAgICAgICAgXCJ0eXBlXCI6IFwiUE9TVFwiLFxuICAgICAgICB1cmw6IE0uY2ZnLnd3d3Jvb3QgKyBcIi9tb2QvdHVybml0aW50b29sdHdvL2FqYXgucGhwXCIsXG4gICAgICAgIFwiZGF0YVwiOiB7YWN0aW9uOiBcImJlZ2luX21pZ3JhdGlvblwiLCBjb3Vyc2VpZDogY291cnNlaWQsIHR1cm5pdGludG9vbGlkOiB0dXJuaXRpbnRvb2xpZCwgc2Vzc2tleTogTS5jZmcuc2Vzc2tleX0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGlmICgkLmNvbG9yYm94KSB7XG4gICAgICAgICAgICAgICAgJC5jb2xvcmJveC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gTS5jZmcud3d3cm9vdCArIFwiL21vZC90dXJuaXRpbnRvb2x0d28vdmlldy5waHA/aWQ9XCIrZGF0YS5pZDtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGVycm9yLnJlc3BvbnNlSlNPTjtcbiAgICAgICAgICAgIGlmICgkLmNvbG9yYm94KSB7XG4gICAgICAgICAgICAgICAgJC5jb2xvcmJveC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcbiAgICAgICAgICAgICQoJyN0dXJuaXRpbnRvb2xfc3R5bGUnKVxuICAgICAgICAgICAgICAgIC5wcmVwZW5kKCc8ZGl2IGlkPVwiZnVsbC1lcnJvclwiIGNsYXNzPVwiYm94IGdlbmVyYWxib3ggbm90aWNlYm94XCI+JyArIGRhdGEuZXJyb3IgKyAnICcgKyBkYXRhLm1lc3NhZ2UgKyAnPC9kaXY+Jyk7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgYSBzdGFjayB0cmFjZSBpbmNsdWRlZC5cbiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCd0cmFjZScpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihkYXRhLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoSlNPTi5zdHJpbmdpZnkoZGF0YS50cmFjZSwgbnVsbCwgNCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGxpZ2h0Qm94Q2xvc2VCdXR0b24oKSB7XG4gICAgJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD1cInRpaV9jbG9zZV9iYXJcIj48YSBocmVmPVwiI1wiIG9uY2xpY2s9XCIkLmNvbG9yYm94LmNsb3NlKCk7IHJldHVybiBmYWxzZTtcIj4nICsgTS5zdHIudHVybml0aW50b29sdHdvLmNsb3NlYnV0dG9uICsgJzwvYT48L2Rpdj4nKTtcbn1cbiJdfQ==
